#!/bin/bash
DOTFILES_DIR=$HOME/dotfiles

# set up homebrew
brew > /dev/null 2>&1
if [ $? -eq 127 ]
  then
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    brew update && brew cleanup && brew cask cleanup
fi

# Install cask
brew tap caskroom/cask
brew upgrade brew-cask

# https://github.com/Homebrew/homebrew-completions
brew_install bash-completion
brew tap homebrew/completions

function brew_install {
  if [[ $(brew list | grep $1) == 1 ]]; then
      brew install $1
  fi
}


# ?
brew tap caskroom/versions
brew tap homebrew/boneyard
brew tap caskroom/fonts

# Git
GIT_DIR=$DOTFILES_DIR/git
ln -sf $GIT_DIR/gitignore $HOME/.gitignore
ln -sf $GIT_DIR/gitconfig $HOME/.gitconfig
ln -sf $GIT_DIR/git-completion.bash $HOME/.git-completion.bash
ln -sf $GIT_DIR/hub-completion.bash $HOME/.hub-completion.bash

brew_install hub
if [ ! -d $HOME/.config ]; then
  mkdir $HOME/.config
fi
ln -sf $GIT_DIR/hub-config $HOME/.config/hub

git config --global hub.protocol https

# Bash
BASH_DIR=$DOTFILES_DIR/bash
ln -sf $BASH_DIR/bashrc $HOME/.bashrc
ln -sf $BASH_DIR/bashrc $HOME/.bash_profile

# terminal
brew cask install iterm2
source $HOME/.bashrc

# Vim
VIM_DIR=$HOME/.vim
if [ ! -d $VIM_DIR ]; then
    mkdir $VIM_DIR
fi
(cd $VIM_DIR && git status > /dev/null 2>&1)
if [ $? -eq 128 ]; then
    echo "cloning vimconfig"
    git clone vimconfig $VIM_DIR
    (cd $VIM_DIR && git submodule update --init)
fi
ln -sf $VIM_DIR/vimrc-english $HOME/.vimrc

# python
brew install python
brew install python3
#curl -L https://bootstrap.pypa.io/get-pip.py -o /tmp/get-pip.py
#python /tmp/get-pip.py
sudo pip install --upgrade pip
sudo pip install virtualenv
sudo pip install virtualenvwrapper

# python dev environment
sudo pip install cookiecutter
COOKIECUTTER_DIR=$HOME/.cookicutters
mkdir $COOKIECUTTER_DIR
git clone https://github.com/shaunokeefe/python_cli_cookiecutter.git $COOKIECUTTER_DIR/python_cli

# OSX defaults

# Function keys are standard function keys
defaults write -g com.apple.keyboard.fnState -bool true

# Use AirDrop over every interface. srsly this should be a default.
defaults write com.apple.NetworkBrowser BrowseAllInterfaces 1

# Always open everything in Finder's list view. This is important.
defaults write com.apple.Finder FXPreferredViewStyle Nlsv

# Show the ~/Library folder.
chflags nohidden ~/Library

# Set a really fast key repeat.
defaults write NSGlobalDomain KeyRepeat -int 0

# Set the Finder prefs for showing a few different volumes on the Desktop.
defaults write com.apple.finder ShowExternalHardDrivesOnDesktop -bool true
defaults write com.apple.finder ShowRemovableMediaOnDesktop -bool true

# don't automatically re-arrange mission control panes
defaults write com.apple.dock mru-spaces -bool false

# apps from cask
brew cask install slack
brew cask install dropbox
brew cask install skype
brew cask install evernote

#iterm profiles
curl -L https://raw.githubusercontent.com/altercation/solarized/master/iterm2-colors-solarized/Solarized%20Dark.itermcolors -o /tmp/SolarizedDark.itermcolors
curl -L https://raw.githubusercontent.com/altercation/solarized/master/iterm2-colors-solarized/Solarized%20Light.itermcolors -o /tmp/SolarizedLight.itermcolors

# ssh config
mkdir -p $HOME/.ssh/config
ln -sf $HOME/Dropbox/config $HOME/.ssh/config
